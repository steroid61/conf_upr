# Учебный конфигурационный язык в JSON-конвертер

Это проект реализует инструмент командной строки для преобразования текстов на учебном конфигурационном языке в формат JSON. Инструмент также включает тесты, покрывающие все конструкции языка, включая возможную вложенность.

## Оглавление

- [Описание](#описание)
- [Структура проекта](#структура-проекта)
- [Установка и запуск](#установка-и-запуск)
  - [Требования](#требования)
  - [Запуск конвертера](#запуск-конвертера)
  - [Запуск тестов](#запуск-тестов)
- [Синтаксис языка](#синтаксис-языка)
  - [Комментарии](#комментарии)
  - [Массивы](#массивы)
  - [Имена](#имена)
  - [Значения](#значения)
  - [Объявление констант](#объявление-констант)
  - [Вычисление константных выражений](#вычисление-константных-выражений)
  - [Операции и функции](#операции-и-функции)
- [Примеры конфигураций](#примеры-конфигураций)
- [Тестирование](#тестирование)
- [Лицензия](#лицензия)

## Описание

Данный инструмент предназначен для преобразования текстов, написанных на учебном конфигурационном языке, в формат JSON. Он выполняет синтаксический анализ входного файла, обнаруживает синтаксические ошибки и сообщает о них пользователю. Инструмент поддерживает все заданные конструкции языка и обеспечивает возможность вычисления константных выражений на этапе трансляции.

## Структура проекта

- `config_to_json.py` — основной файл с реализацией парсера `ConfigParser` и командного интерфейса.
- `tests.py` — набор автоматических тестов для проверки корректности работы парсера.
- `README.md` — данный файл с описанием проекта и инструкциями.
- Примеры конфигурационных файлов и ожидаемых выходных данных включены в тесты внутри `tests.py`.

## Установка и запуск

### Требования

- Python 3.6 или выше
- Операционная система Windows, macOS или Linux

### Запуск конвертера

1. **Клонируйте репозиторий или скопируйте файлы проекта в отдельную директорию.**

2. **Создайте входной файл конфигурации**, например, `input.txt`, с содержимым на учебном конфигурационном языке.

3. **Запустите конвертер из командной строки:**

   ```bash
   python config_to_json.py -i input.txt -o output.json
   ```

   - `-i input.txt` — путь к входному файлу конфигурации.
   - `-o output.json` — путь к выходному JSON-файлу.

4. **Просмотрите выходной файл** `output.json`, чтобы убедиться в корректности преобразования.

**Пример:**

Содержимое `input.txt`:

```plaintext
# Настройки сервера
var server_ports := [80, 443, 8080]
var default_port := { server_ports 0 index() }
var sorted_ports := { server_ports sort() }
```

Запуск конвертера:

```bash
python config_to_json.py -i input.txt -o output.json
```

Содержимое `output.json`:

```json
[
  {
    "var": "server_ports",
    "value": [80, 443, 8080]
  },
  {
    "var": "default_port",
    "value": 80
  },
  {
    "var": "sorted_ports",
    "value": [80, 443, 8080]
  }
]
```

### Запуск тестов

Для проверки корректности работы парсера выполните следующие шаги:

1. **Убедитесь, что файлы `config_to_json.py` и `tests.py` находятся в одной директории.**

2. **Запустите тесты командой:**

   ```bash
   python tests.py
   ```

3. **Ожидаемый вывод:**

   ```
   Test 1: Passed.
   Test 2: Passed.
   Test 3: Passed.
   Test 4: Passed.
   Test 5: Passed.
   Test 6: Passed.
   Test 7: Passed (expected error).
   Test 8: Passed (expected error).
   Test 9: Passed.
   Test 10: Passed.
   Test 11: Passed.
   Test 12: Passed.

   Total tests passed: 12 out of 12
   ```

Тесты покрывают все конструкции языка и проверяют как корректную работу парсера, так и обработку ошибок.

## Синтаксис языка

### Комментарии

- **Однострочные комментарии** начинаются с символа `#` и продолжаются до конца строки.

  ```plaintext
  # Это однострочный комментарий
  ```

- **Многострочные комментарии** заключены между `(comment` и `)` и могут содержать несколько строк.

  ```plaintext
  (comment
  Это многострочный
  комментарий
  )
  ```

### Массивы

- Массивы определяются с помощью квадратных скобок `[]` и содержат значения, разделенные запятыми.

  ```plaintext
  [ значение1, значение2, значение3 ]
  ```

  **Пример:**

  ```plaintext
  var numbers := [1, 2, 3, 4, 5]
  ```

### Имена

- Имена переменных состоят из букв латинского алфавита, цифр и символа подчеркивания, начинаются с буквы или подчеркивания.

  ```plaintext
  [a-zA-Z_][a-zA-Z0-9_]*
  ```

  **Пример:**

  ```plaintext
  var my_variable := 10
  ```

### Значения

- **Числа**: целые числа без десятичной части.

  ```plaintext
  var x := 42
  ```

- **Массивы**: список значений.

  ```plaintext
  var arr := [1, 2, 3]
  ```

### Объявление констант

- Объявление константы выполняется с помощью ключевого слова `var`, имени переменной, оператора `:=` и значения.

  ```plaintext
  var имя := значение
  ```

  **Пример:**

  ```plaintext
  var pi := 3
  ```

### Вычисление константных выражений

- Константные выражения заключаются в фигурные скобки `{}` и записываются в постфиксной форме (обратная польская нотация).

  ```plaintext
  { операнд1 операнд2 оператор }
  ```

  **Пример:**

  ```plaintext
  var sum := { 10 20 + }
  ```

### Операции и функции

- **Операции:**
  - `+` — сложение
  - `-` — вычитание
  - `*` — умножение

- **Функции:**
  - `sort()` — сортировка массива
  - `index()` — получение элемента массива по индексу

  **Примеры:**

  ```plaintext
  var sorted_arr := { arr sort() }
  var first_element := { arr 0 index() }
  ```

## Примеры конфигураций

### Пример 1: Настройки приложения

```plaintext
# Настройки приложения
var app_name := "MyApp"
var version := 1
var supported_versions := [1, 2, 3]
var latest_version := { supported_versions -1 index() }
```

### Пример 2: Математические вычисления

```plaintext
# Вычисление площади круга
var pi := 3
var radius := 5
var area := { pi radius radius * * }
```

## Тестирование

Тесты, включенные в файл `tests.py`, проверяют следующие аспекты:

1. **Объявление переменных и присваивание числовых значений.**
2. **Использование массивов и функций `sort()` и `index()`.**
3. **Выполнение математических операций (`+`, `-`, `*`).**
4. **Корректную обработку однострочных и многострочных комментариев.**
5. **Обработку ошибок, связанных с синтаксическими ошибками и использованием неопределённых переменных.**
6. **Вложенность массивов и выражений.**

**Пример теста из `tests.py`:**

```python
# Тест 5: Математические операции
test5_input = '''
var a := 5
var b := 3
var sum := { a b + }
var product := { a b * }
var difference := { a b - }
'''
test5_expected_output = [
    {"var": "a", "value": 5},
    {"var": "b", "value": 3},
    {"var": "sum", "value": 8},
    {"var": "product", "value": 15},
    {"var": "difference", "value": 2}
]
```